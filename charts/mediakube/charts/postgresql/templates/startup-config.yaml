apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ include ".helm.fullname" . }}-startup"
data:
  {{- if (hasKey .Values.startUp "fileContent") }}
  configdata.sql: |
{{ .Values.startUp.fileContent | indent 4 }}
  {{ else }}
  configdata.sql: |
    -- radarr
    SELECT 'CREATE DATABASE {{ .Values.global.radarrMainDb }} '
    'WITH '
    'ENCODING = ''UTF8'' '
    'CONNECTION LIMIT = -1 '
    'IS_TEMPLATE = False'
    WHERE NOT EXISTS (SELECT FROM pg_database WHERE datname = '{{ .Values.global.radarrMainDb }}')\gexec
    ;
    SELECT 'CREATE DATABASE {{ .Values.global.radarrLogDb }} '
    'WITH '
    'ENCODING = ''UTF8'' '
    'CONNECTION LIMIT = -1 '
    'IS_TEMPLATE = False'
    WHERE NOT EXISTS (SELECT FROM pg_database WHERE datname = '{{ .Values.global.radarrLogDb }}')\gexec
    ;
  {{- end }}
  {{- if (hasKey .Values.startUp "scriptContent") }}
  configdata.sh: |
{{ .Values.startUp.scriptContent | indent 4 }}
  {{- end }}